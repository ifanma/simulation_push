function [A, B] = linearization(t, param, dt, edge_preset)
    % x_next = A * x + B * u;

    [x_star, u_star] = param.traj(t, param);
    x3 = x_star(3);
    x4 = x_star(4);
    x5 = x_star(5);
    u1 = u_star(1);
    u2 = u_star(2);

    % 下面的A，B形式是固定的
    if edge_preset == 1
        A = ... 
           [[0, 0, (147*u2*cos(x3))/50 - (147*u1*sin(x3))/50,                 0,                 0];
            [0, 0, (147*u1*cos(x3))/50 + (147*u2*sin(x3))/50,                 0,                 0];
            [0, 0, 0,                      -(22491*u2)/10000, -(22491*u1)/10000];
            [0, 0, 0,                 0,                 0];
            [0, 0, 0,                 0,                 0]];
        B = ...
           [[       (147*cos(x3))/50,        (147*sin(x3))/50,  0];
            [       (147*sin(x3))/50,       -(147*cos(x3))/50,  0];
            [      -(22491*x5)/10000,       -(22491*x4)/10000,  0];
            [                      0,                       0,  0];
            [                      0,                       0, -1]];
    elseif edge_preset == 2
        A = ...
           [[0, 0, (147*u1*cos(x3))/50 + (147*u2*sin(x3))/50,                 0,                0];
            [0, 0, (147*u1*sin(x3))/50 - (147*u2*cos(x3))/50,                 0,                0];
            [0, 0,                                         0, -(22491*u1)/10000, (22491*u2)/10000];
            [0, 0,                                         0,                 0,                0];
            [0, 0,                                         0,                 0,                0]];
        B = ...
           [[       (147*sin(x3))/50,      -(147*cos(x3))/50,  0];
            [      -(147*cos(x3))/50,      -(147*sin(x3))/50,  0];
            [      -(22491*x4)/10000,       (22491*x5)/10000,  0];
            [                      0,                      0, -1];
            [                      0,                      0,  0]];
    elseif edge_preset == 3
        A = ...
           [[0, 0,   (147*u1*sin(x3))/50 - (147*u2*cos(x3))/50,                0,                0];
            [0, 0, - (147*u1*cos(x3))/50 - (147*u2*sin(x3))/50,                0,                0];
            [0, 0,                                           0, (22491*u2)/10000, (22491*u1)/10000];
            [0, 0,                                           0,                0,                0];
            [0, 0,                                           0,                0,                0]];
        B = ...
           [[     -(147*cos(x3))/50,      -(147*sin(x3))/50, 0];
            [     -(147*sin(x3))/50,       (147*cos(x3))/50, 0];
            [      (22491*x5)/10000,       (22491*x4)/10000, 0];
            [                     0,                      0, 0];
            [                     0,                      0, 1]];
    elseif edge_preset == 4
        A = ...
           [[0, 0, - (147*u1*cos(x3))/50 - (147*u2*sin(x3))/50,                0,                 0];
            [0, 0,   (147*u2*cos(x3))/50 - (147*u1*sin(x3))/50,                0,                 0];
            [0, 0,                                           0, (22491*u1)/10000, -(22491*u2)/10000];
            [0, 0,                                           0,                0,                 0];
            [0, 0,                                           0,                0,                 0]];
        B = ...
           [[     -(147*sin(x3))/50,        (147*cos(x3))/50, 0];
            [      (147*cos(x3))/50,        (147*sin(x3))/50, 0];
            [      (22491*x4)/10000,       -(22491*x5)/10000, 0];
            [                     0,                       0, 1];
            [                     0,                       0, 0]];
    end

    A = dt * A + eye(5);
    B = B * dt;

end

